local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- // Logic Variables //
local hiddenfling = false
local flingPower = 10000
local spinEnabled = false
local spinSpeed = 20
local blackoutEnabled = false

local controllerPlayer = nil
local isSlave = false
local standPlatform = nil
local isBusy = false
local signalConnection = nil

-- // Anti-Fling detection setup (required for internal fling command) //
if not ReplicatedStorage:FindFirstChild("juisdfj0i32i0eidsuf0iok") then
    local detection = Instance.new("Decal")
    detection.Name = "juisdfj0i32i0eidsuf0iok"
    detection.Parent = ReplicatedStorage
end

-- // Internal Fling Logic (Only used if Master commands it) //
local function fling()
    local hrp, c, vel, movel = nil, nil, nil, 0.1
    while true do
        RunService.Heartbeat:Wait()
        if hiddenfling then
            while hiddenfling and not (c and c.Parent and hrp and hrp.Parent) do
                RunService.Heartbeat:Wait()
                c = LocalPlayer.Character
                hrp = c and c:FindFirstChild("HumanoidRootPart")
            end
            if hiddenfling then
                vel = hrp.Velocity
                hrp.Velocity = vel * flingPower + Vector3.new(0, flingPower, 0)
                RunService.RenderStepped:Wait()
                if c and c.Parent and hrp and hrp.Parent then
                    hrp.Velocity = vel
                end
                RunService.Stepped:Wait()
                if c and c.Parent and hrp and hrp.Parent then
                    hrp.Velocity = vel + Vector3.new(0, movel, 0)
                    movel = movel * -1
                end
            end
        end
    end
end
task.spawn(fling)

-- // Signals Dictionary //
local SIGNALS = {
    ["507770239"] = "bring",
    ["507770453"] = "jump",
    ["507770818"] = "kill",
    ["507771019"] = "stand",
    ["507771955"] = "void",
    ["507772104"] = "spin",
    ["507776879"] = "jumpscare",
    ["507766388"] = "free",
    ["507771666"] = "fling_self",
    ["507765000"] = "blackout"
}

-- // Status GUI //
local StatusGui = Instance.new("ScreenGui")
StatusGui.Name = "VenusStatus"
StatusGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
StatusGui.ResetOnSpawn = false

local StatusFrame = Instance.new("Frame")
StatusFrame.Size = UDim2.new(0, 300, 0, 30)
StatusFrame.Position = UDim2.new(0.5, -150, 0, 10)
StatusFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
StatusFrame.BorderSizePixel = 0
StatusFrame.Parent = StatusGui

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 6)
StatusCorner.Parent = StatusFrame

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, 0, 1, 0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "STATUS: FREE"
StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
StatusLabel.Font = Enum.Font.GothamBold
StatusLabel.TextSize = 14
StatusLabel.Parent = StatusFrame

local function updateStatus(text, color)
    StatusLabel.Text = text
    StatusLabel.TextColor3 = color
end

-- // Utility Functions //
local function findPlayerPartial(text)
    for _, p in pairs(Players:GetPlayers()) do
        if string.find(string.lower(p.Name), string.lower(text)) or string.find(string.lower(p.DisplayName), string.lower(text)) then
            return p
        end
    end
    return nil
end

local function triggerJumpscare()
    local sc = Instance.new("ScreenGui")
    sc.Name = "JumpscareGUI"
    sc.Parent = LocalPlayer.PlayerGui
    sc.IgnoreGuiInset = true
    local img = Instance.new("ImageLabel")
    img.Parent = sc
    img.Size = UDim2.new(1,0,1,0)
    img.Image = "rbxassetid://5565362953"
    img.BackgroundColor3 = Color3.new(0,0,0)
    local snd = Instance.new("Sound")
    snd.Parent = sc
    snd.SoundId = "rbxassetid://9120339906"
    snd.Volume = 10
    snd.PlayOnRemove = true
    snd:Play()
    task.wait(2)
    sc:Destroy()
end

local function flingTargetPlayer(targetPlayer)
    local targetChar = targetPlayer.Character
    if not targetChar or not targetChar:FindFirstChild("HumanoidRootPart") then
        return
    end
    local targetHRP = targetChar.HumanoidRootPart

    local flingPart = Instance.new("Part")
    flingPart.Name = "FlingPart"
    flingPart.Size = Vector3.new(5, 5, 5)
    flingPart.Transparency = 1
    flingPart.CanCollide = false
    flingPart.Position = targetHRP.Position
    flingPart.Parent = workspace

    local weld = Instance.new("WeldConstraint")
    weld.Part0 = flingPart
    weld.Part1 = targetHRP
    weld.Parent = flingPart

    local bv = Instance.new("BodyVelocity")
    bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bv.Velocity = Vector3.new(0, flingPower * 5, 0)
    bv.Parent = flingPart

    task.delay(1.5, function()
        if bv then bv:Destroy() end
        if weld then weld:Destroy() end
        if flingPart then flingPart:Destroy() end
    end)
end

-- // UI Library //
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Venus Controlled",
    LoadingTitle = "Venus Slave Logic",
    LoadingSubtitle = "Obey & Control",
    Theme = "Ocean",
    ConfigurationSaving = {
        Enabled = true,
        FileName = "VenusSlaveConfig"
    },
})

local function Notify(title, content, duration)
    Rayfield:Notify({
        Title = title,
        Content = content,
        Duration = duration or 3,
        Image = 4483362458,
    })
end

-- // Stand Logic (Positioning) //
local function standLogic()
    if isSlave and controllerPlayer and controllerPlayer.Character and controllerPlayer.Character:FindFirstChild("HumanoidRootPart") then
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            if not isBusy then
                local char = LocalPlayer.Character
                local tRoot = controllerPlayer.Character.HumanoidRootPart
                local cRoot = char.HumanoidRootPart
                local hum = char:FindFirstChild("Humanoid")
                if hum then
                    hum:ChangeState(Enum.HumanoidStateType.Physics)
                end
                
                -- Create invisible platform to stand on
                if not standPlatform then
                    standPlatform = Instance.new("Part")
                    standPlatform.Size = Vector3.new(4, 0.5, 4)
                    standPlatform.Transparency = 1 -- Made fully transparent
                    standPlatform.Anchored = true
                    standPlatform.CanCollide = true
                    standPlatform.Name = "StandPlatform"
                    standPlatform.Parent = workspace
                end
                
                local bob = math.sin(tick() * 2) * 0.8
                
                -- UPDATED POSITION: Positive Z is Backward. 
                -- 0, 3+bob, 4 puts the slave 4 studs BEHIND the master and slightly up.
                local goalCF = tRoot.CFrame * CFrame.new(0, 3 + bob, 4)
                
                if standPlatform then
                    standPlatform.CFrame = goalCF * CFrame.new(0, -3, 0)
                end
                cRoot.CFrame = cRoot.CFrame:Lerp(goalCF, 0.15)
                cRoot.Velocity = Vector3.zero
            else
                if standPlatform then standPlatform.CFrame = CFrame.new(0, -500, 0) end
            end
        end
    else
        if standPlatform then standPlatform:Destroy() standPlatform = nil end
    end
end
RunService.Heartbeat:Connect(standLogic)

-- // Spin Logic (Triggered by Master) //
RunService.Heartbeat:Connect(function()
    if spinEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.Angles(0, math.rad(spinSpeed), 0)
    end
end)

-- // Blackout Logic //
task.spawn(function()
    while true do
        task.wait(0.3)
        if blackoutEnabled and (not LocalPlayer.PlayerGui:FindFirstChild("BlackoutGui")) then
            local gui = Instance.new("ScreenGui")
            gui.Name = "BlackoutGui"
            gui.ResetOnSpawn = false
            gui.IgnoreGuiInset = true
            gui.Parent = LocalPlayer.PlayerGui
            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(1, 0, 1, 0)
            frame.BackgroundColor3 = Color3.new(0, 0, 0)
            frame.ZIndex = 999
            frame.Parent = gui
        end
    end
end)

-- // Command Execution //
local function executeCommand(cmd)
    if not isSlave then return end
    Notify("Command Received", cmd, 3)
    if cmd == "jump" then
        if LocalPlayer.Character then LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping) end
    elseif cmd == "bring" then
        isBusy = true
        if LocalPlayer.Character and controllerPlayer and controllerPlayer.Character then
            -- Teleport behind master
            LocalPlayer.Character.HumanoidRootPart.CFrame = controllerPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,0,4)
        end
        task.wait(0.5)
        isBusy = false
    elseif cmd == "spin" then
        spinEnabled = not spinEnabled
    elseif cmd == "kill" then
        isBusy = true
        LocalPlayer.Character:BreakJoints()
        task.wait(1)
        isBusy = false
    elseif cmd == "void" then
        isBusy = true
        LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(0, -500, 0)
        task.wait(1)
        isBusy = false
    elseif cmd == "jumpscare" then
        triggerJumpscare()
    elseif cmd == "fling_self" then
        isBusy = true
        hiddenfling = true
        task.wait(2)
        hiddenfling = false
        isBusy = false
    elseif cmd == "stand" then
        isBusy = false
    elseif cmd == "free" then
        isSlave = false
        controllerPlayer = nil
        if signalConnection then
            signalConnection:Disconnect()
            signalConnection = nil
        end
        if standPlatform then
            standPlatform:Destroy()
            standPlatform = nil
        end
        updateStatus("STATUS: FREE", Color3.fromRGB(100, 255, 100))
        Notify("Freed", "You are no longer controlled.", 5)
    elseif cmd == "blackout" then
        blackoutEnabled = not blackoutEnabled
        if not blackoutEnabled and LocalPlayer.PlayerGui:FindFirstChild("BlackoutGui") then
            LocalPlayer.PlayerGui.BlackoutGui:Destroy()
        end
        Notify("Blackout", blackoutEnabled and "Enabled (permanent)" or "Disabled", 3)
    end
end

-- // Signal Listener //
local function initSignalListener(master)
    if signalConnection then signalConnection:Disconnect() end
    local hum = master.Character and master.Character:FindFirstChild("Humanoid")
    if hum then
        local animator = hum:FindFirstChild("Animator") or hum:WaitForChild("Animator")
        signalConnection = animator.AnimationPlayed:Connect(function(track)
            local id = track.Animation.AnimationId
            local cleanID = string.match(id, "%d+")
            if SIGNALS[cleanID] then
                executeCommand(SIGNALS[cleanID])
            end
        end)
    end
    master.CharacterAdded:Connect(function(newChar)
        local h = newChar:WaitForChild("Humanoid")
        local a = h:WaitForChild("Animator")
        if signalConnection then signalConnection:Disconnect() end
        signalConnection = a.AnimationPlayed:Connect(function(track)
            local id = track.Animation.AnimationId
            local cleanID = string.match(id, "%d+")
            if SIGNALS[cleanID] then
                executeCommand(SIGNALS[cleanID])
            end
        end)
    end)
end

local function broadcastSignal(id)
    if LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
        local animator = hum and hum:FindFirstChild("Animator")
        if animator then
            local anim = Instance.new("Animation")
            anim.AnimationId = "rbxassetid://" .. id
            local track = animator:LoadAnimation(anim)
            track.Priority = Enum.AnimationPriority.Action
            track:Play()
            task.wait(0.1)
            track:Stop()
        end
    end
end

-- // GUI Tabs //

local MainTab = Window:CreateTab("Be Controlled", 4483362458)
local connectInputName = ""

MainTab:CreateLabel("Type a player's name to become their Stand/Slave.")
MainTab:CreateInput({
    Name = "Master's Name",
    PlaceholderText = "Type Player Name to OBEY",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        connectInputName = Text
    end,
})
MainTab:CreateButton({
    Name = "Submit & Obey",
    Callback = function()
        local t = findPlayerPartial(connectInputName)
        if t and t ~= LocalPlayer then
            controllerPlayer = t
            isSlave = true
            initSignalListener(t)
            updateStatus("SLAVE (Controlled by " .. t.Name .. ")", Color3.fromRGB(255, 50, 50))
            Notify("Submitted", "You are now controlled by " .. t.Name .. ".", 5)
        else
            Notify("Error", "Player invalid or not found", 3)
        end
    end,
})

local RemoteTab = Window:CreateTab("Control Others", 4483362458)
RemoteTab:CreateLabel("Use these to control players running this script.")
RemoteTab:CreateLabel("You must use an animation script or these buttons.")

local flingTargetName = ""
RemoteTab:CreateInput({
    Name = "Fling Target Name",
    PlaceholderText = "Type player name to fling",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        flingTargetName = Text
    end,
})
RemoteTab:CreateButton({
    Name = "Fling Typed Player",
    Callback = function()
        local t = findPlayerPartial(flingTargetName)
        if t and t ~= LocalPlayer then
            flingTargetPlayer(t)
        else
            Notify("Error", "Player not found or invalid", 3)
        end
    end,
})

RemoteTab:CreateSection("Commands")
RemoteTab:CreateButton({
    Name = "Toggle Slave Blackout (Blind)",
    Callback = function() broadcastSignal("507765000") end,
})
RemoteTab:CreateButton({
    Name = "Jumpscare Them",
    Callback = function() broadcastSignal("507776879") end,
})
RemoteTab:CreateButton({
    Name = "Kill Them",
    Callback = function() broadcastSignal("507770818") end,
})
RemoteTab:CreateButton({
    Name = "Fling Them (Up)",
    Callback = function() broadcastSignal("507771666") end,
})
RemoteTab:CreateButton({
    Name = "Void Them",
    Callback = function() broadcastSignal("507771955") end,
})
RemoteTab:CreateButton({
    Name = "Summon as Stand (Reset)",
    Callback = function() broadcastSignal("507771019") end,
})
RemoteTab:CreateButton({
    Name = "Bring Slaves to Me",
    Callback = function() broadcastSignal("507770239") end,
})
RemoteTab:CreateButton({
    Name = "Make Slaves Jump",
    Callback = function() broadcastSignal("507770453") end,
})
RemoteTab:CreateButton({
    Name = "Toggle Slave Spin",
    Callback = function() broadcastSignal("507772104") end,
})
RemoteTab:CreateButton({
    Name = "Free Slaves",
    Callback = function() broadcastSignal("507766388") end,
})

local MiscTab = Window:CreateTab("Settings", 4483362458)
MiscTab:CreateButton({
    Name = "Destroy UI",
    Callback = function()
        Rayfield:Destroy()
    end,
})
